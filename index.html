<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List Online - Minimalist, No-Login Required Web Todo App</title>
    <meta name="keywords"
        content="online todo list, minimalist todo app, no login todo, web todo list, todo manager, task scheduler, memo app, browser-based todo, instant access, secure storage, personal todo, professional todo, work and life assistant">
    <meta name="description"
        content="uiineed's Todo List Online is a minimalist, no-login-required web app that helps you manage your tasks and schedules effortlessly. Store your todos securely in your browser's local cache, and enjoy a seamless experience without the hassle of sign-ups or logins. Perfect for both personal and professional use!">
    <link type="favicon" rel="shortcut icon" href="public/img/favicon.png" />
    <link href="public/css/normalize.css" rel="stylesheet" media="screen">
    <link href="public/css/style.min.css" rel="stylesheet" media="screen">
    <link href="public/css/style.css" rel="stylesheet" media="screen">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap&subset=vietnamese" rel="stylesheet">

    <script>
        // Automatically detect and switch language
        const browserLanguage = navigator.language || navigator.userLanguage;
        const languageCode = browserLanguage.split('-')[0].toLowerCase();
        if (!localStorage.getItem('uiineed-todos-lang')) localStorage.setItem('uiineed-todos-lang', languageCode);
        const userLanguage = localStorage.getItem('uiineed-todos-lang');
        if (userLanguage && userLanguage === "zh") window.location.href = (window.location.pathname === "/") ? 'index-zh.html' : window.location.href.replace('index.html', 'index-zh.html');
    </script>
    <script>
        const nativeAlert = window.alert;
        window.alert = function (message, title = 'Prompt') {
            return new Promise((resolve) => {
                const overlay = document.createElement('div');
                overlay.className = 'custom-alert-overlay';
                const alertBox = document.createElement('div');
                alertBox.className = 'custom-alert';
                alertBox.innerHTML = `
<div class="custom-alert-title">${title}</div>
<div class="custom-alert-content">${message}</div>
<div class="custom-alert-buttons">
    <button class="custom-alert-btn confirm">OK</button>
</div>
                    `;
                overlay.appendChild(alertBox);
                document.body.appendChild(overlay);
                const confirmBtn = alertBox.querySelector('.confirm');
                confirmBtn.addEventListener('click', () => {
                    alertBox.style.animation = 'popOut 0.3s forwards';
                    setTimeout(() => {
                        document.body.removeChild(overlay);
                        resolve(true);
                    }, 300);
                });
                overlay.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') confirmBtn.click();
                });
                confirmBtn.focus();
            });
        };
        const nativeConfirm = window.alert;
        window.confirm = function (message, title = 'Please Confirm') {
            return new Promise((resolve) => {
                const overlay = document.createElement('div');
                overlay.className = 'custom-alert-overlay';
                const alertBox = document.createElement('div');
                alertBox.className = 'custom-alert';
                alertBox.innerHTML = `
<div class="custom-alert-title">${title}</div>
<div class="custom-alert-content">${message}</div>
<div class="custom-alert-buttons">
    <button class="custom-alert-btn cancel">Cancel</button>
    <button class="custom-alert-btn confirm">OK</button>
</div>
                    `;
                overlay.appendChild(alertBox);
                document.body.appendChild(overlay);
                const confirmBtn = alertBox.querySelector('.confirm');
                const cancelBtn = alertBox.querySelector('.cancel');
                confirmBtn.addEventListener('click', () => {
                    alertBox.style.animation = 'popOut 0.3s forwards';
                    setTimeout(() => {
                        document.body.removeChild(overlay);
                        resolve(true);
                    }, 300);
                });
                cancelBtn.addEventListener('click', () => {
                    alertBox.style.animation = 'popOut 0.3s forwards';
                    setTimeout(() => {
                        document.body.removeChild(overlay);
                        resolve(false);
                    }, 300);
                });
                overlay.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') cancelBtn.click();
                });
                cancelBtn.focus();
            });
        };
    </script>
    <!-- Vue 2.x Todo List -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script> -->
    <script src="public/js/vue.js"></script>
    <style>
        /* Inline CSS to fix display issues */
        .todo-wrapper {
            display: block !important;
            width: 100%;
            margin: 40px auto;
        }

        .todo-app {
            display: block !important;
        }

        /* Add styles for overdue tasks and priority indicators */
        .overdue {
            color: #ff5252 !important;
            position: relative;
        }

        .overdue::before {
            content: "⚠️";
            margin-right: 5px;
        }

        .todo-item .overdue::before {
            position: absolute;
            left: -22px;
            top: 50%;
            transform: translateY(-50%);
        }

        .priority-high {
            border-left: 4px solid #ff5252 !important;
        }

        .priority-medium {
            border-left: 4px solid #ffc107 !important;
        }

        .priority-low {
            border-left: 4px solid #8bc34a !important;
        }

        .sort-controls {
            margin-bottom: 10px;
            padding: 8px;
            background: #fff;
            border: var(--border);
            border-radius: var(--border-radius);
        }

        .sort-controls select {
            padding: 5px 10px;
            margin-left: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Thêm CSS cho thông báo nhắc nhở */
        .reminder-notification {
            position: fixed;
            top: 50px;
            right: 20px;
            width: 300px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 990;
            overflow: hidden;
            border: var(--border);
        }

        .reminder-header {
            background-color: #ff9800;
            color: white;
            padding: 12px 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reminder-header .close-btn {
            cursor: pointer;
            font-size: 18px;
        }

        .reminder-body {
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .reminder-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .reminder-item:last-child {
            border-bottom: none;
        }

        .reminder-item .task-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .reminder-item .days-left {
            font-size: 0.9em;
            color: #ff5252;
        }

        .reminder-item .days-left.warning {
            color: #ff9800;
        }

        .reminder-footer {
            padding: 10px 15px;
            background-color: #f5f5f5;
            text-align: center;
            font-size: 0.9em;
        }

        /* CSS cho nút Thêm mới */
        .add-new-task-btn {
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-left: 15px;
        }

        .add-new-task-btn:hover {
            background-color: #45a049;
        }

        /* CSS cho thanh tiến độ trên mỗi task */
        .task-progress-bar-container {
            width: 127px;
            height: 33px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 0 50px;
            position: relative;
            flex-shrink: 0;
        }

        .task-progress-bar {
            height: 100%;
            background-color: #4caf50;
            transition: width 0.3s ease;
        }

        /* Màu sắc tiến độ khác nhau dựa trên % hoàn thành */
        .task-progress-low .task-progress-bar {
            background-color: #ff5252;
            /* Đỏ cho tiến độ thấp (0-30%) */
        }

        .task-progress-medium .task-progress-bar {
            background-color: #ffc107;
            /* Vàng cho tiến độ trung bình (31-70%) */
        }

        .task-progress-high .task-progress-bar {
            background-color: #4caf50;
            /* Xanh cho tiến độ cao (71-100%) */
        }

        .task-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8px;
            color: #000;
            font-weight: bold;
        }

        /* Điều chỉnh layout cho các item task để hiển thị thanh tiến độ */
        .todo-item {
            display: flex;
            align-items: center;
        }

        .todo-content {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-right: 5px;
        }

        /* CSS cho task detail popup */
        .task-detail-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .task-detail-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            border: var(--border);
            box-shadow: var(--box-shadow);
        }

        .task-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .task-detail-close {
            font-size: 24px;
            cursor: pointer;
            height: 30px;
            width: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .task-detail-close:hover {
            background-color: #f0f0f0;
        }

        .toast-notification {
            position: fixed;
            right: 24px;
            top: 24px;
            z-index: 989;
            min-width: 300px;
            max-width: 400px;
            padding: 16px 24px;
            background: #ffffff;
            color: #333;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            font-size: 16px;
            line-height: 1.5;
            transform: translateX(150%);
            opacity: 0;
            visibility: hidden;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55),
                opacity 0.4s ease,
                visibility 0.4s ease;
            border-left: 5px solid #4CAF50;
        }
    </style>

</head>

<body>
    <div class="bg-pattern"></div>
    <div class="todo-wrapper">
        <div id="todo-app" class="todo-app" @click="handleClick($event)">
            <div class="container header ">
                <div class="todo-input">
                    <h1 class="title">
                        <img src="public/img/todo.svg" alt="" class="title-1" draggable="false">
                        <div class="ani-vector">
                            <span></span>
                            <span></span>
                        </div>
                        <div class="pendulums">
                            <div class="pendulum">
                                <div class="bar"></div>
                                <div class="motion">
                                    <div class="string"></div>
                                    <div class="weight"></div>
                                </div>
                            </div>
                            <div class="pendulum shadow">
                                <div class="bar"></div>
                                <div class="motion">
                                    <div class="string"></div>
                                    <div class="weight"></div>
                                </div>
                            </div>
                        </div>
                    </h1>
                    <div class="add-content-wrapper">
                        <input type="text" rows="3" class="add-content" placeholder="Tìm kiếm công việc..."
                            v-model="searchQuery" @keyup="searchTodos" :class='{empty:emptyChecked}' />
                        <transition name="tips">
                            <div class="tips" v-if='emptyChecked' style="color:red">💡Please enter content!</div>
                        </transition>
                        <div class="btn-group">
                            <button class="btn submit-btn" type="button" @click="searchTodos">Tìm kiếm</button>
                            <button class="btn advanced-btn" type="button" @click="showAdvancedAdd = true">
                                <span class="advanced-icon">+</span>
                            </button>
                        </div>

                    </div>

                </div>
            </div>

            <!-- todo list -->
            <div class="container main">
                <div class="todo-list-box">
                    <div class="bar-message">
                        <input type="button" class="btn btn-label btn-allFinish" value="Hoàn thành tất cả"
                            @click="markAllAsCompleted" v-if="todos.length || recycleBin.length" />
                        <template>
                            <div>
                                <div v-if="!isEditing" @dblclick="editText" class="bar-message-text">
                                    {{ slogan }}
                                </div>
                                <div v-else="v-else">
                                    <input v-model="slogan" ref="sloganInput" class="slogan-input"
                                        @keyup.enter="saveText" @keyup.esc="cancelText" />
                                    <div class="todo-btn btn-edit-submit slogan-btn" @click="saveText"><img
                                            src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAxOSAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE2LjUwODQgMTAuMzEwOUMxNy4yMzI0IDEwLjU4MjMgMTguMDM5NCAxMC4yMTU1IDE4LjMxMDkgOS40OTE1N0MxOC41ODIzIDguNzY3NiAxOC4yMTU1IDcuOTYwNjMgMTcuNDkxNiA3LjY4OTE0TDE2LjUwODQgMTAuMzEwOVpNOC45OTk5IDJMMTAuMTMyMSAxLjE3NjU1QzkuODU1OCAwLjc5NjYxOCA5LjQwNzM1IDAuNTgwNjA1IDguOTM4MDIgMC42MDEzNjhDOC40Njg3IDAuNjIyMTMgOC4wNDEwNyAwLjg3Njg5OSA3Ljc5OTM4IDEuMjc5NzRMOC45OTk5IDJaTTcuNjcxNzUgMTcuNTU3MkM3LjQyNzIyIDE4LjI5MDcgNy44MjM2MiAxOS4wODM2IDguNTU3MTMgMTkuMzI4MUM5LjI5MDY0IDE5LjU3MjcgMTAuMDgzNSAxOS4xNzYzIDEwLjMyOCAxOC40NDI4TDcuNjcxNzUgMTcuNTU3MlpNMS4wOTk2MyA3LjkyNzkzQzAuNTA3NTQxIDguNDI1MTkgMC40MzA2NjkgOS4zMDgyOCAwLjkyNzkzMSA5LjkwMDM3QzEuNDI1MTkgMTAuNDkyNSAyLjMwODI4IDEwLjU2OTMgMi45MDAzNyAxMC4wNzIxTDEuMDk5NjMgNy45Mjc5M1pNMTcuNDkxNiA3LjY4OTE0QzE1LjgwMjMgNy4wNTU2NSAxMy45ODQxIDUuNTAzNiAxMi41MDk5IDMuOTY3OTVDMTEuNzkzIDMuMjIxMjIgMTEuMTkzOSAyLjUxNzQgMTAuNzc0NCAyLjAwMDU2QzEwLjU2NTEgMS43NDI2OSAxMC40MDE3IDEuNTMyNzYgMTAuMjkxOSAxLjM4OTA4QzEwLjIzNyAxLjMxNzI3IDEwLjE5NTYgMS4yNjIxMSAxMC4xNjg2IDEuMjI1OUMxMC4xNTUxIDEuMjA3OCAxMC4xNDUzIDEuMTk0NDQgMTAuMTM5MSAxLjE4NjEyQzEwLjEzNjEgMS4xODE5NSAxMC4xMzQgMS4xNzkwNSAxMC4xMzI4IDEuMTc3NDRDMTAuMTMyMiAxLjE3NjY0IDEwLjEzMTggMS4xNzYxNiAxMC4xMzE3IDEuMTc2MDFDMTAuMTMxNyAxLjE3NTkzIDEwLjEzMTcgMS4xNzU5NCAxMC4xMzE3IDEuMTc2MDNDMTAuMTMxOCAxLjE3NjA3IDEwLjEzMTkgMS4xNzYyIDEwLjEzMTkgMS4xNzYyM0MxMC4xMzIgMS4xNzYzNyAxMC4xMzIxIDEuMTc2NTUgOC45OTk5IDJDNy44Njc2NyAyLjgyMzQ1IDcuODY3ODMgMi44MjM2NyA3Ljg2OCAyLjgyMzlDNy44NjgwOCAyLjgyNDAxIDcuODY4MjYgMi44MjQyNiA3Ljg2ODQyIDIuODI0NDdDNy44Njg3MiAyLjgyNDkgNy44NjkwOSAyLjgyNTQgNy44Njk1MyAyLjgyNTk5QzcuODcwMzkgMi44MjcxOCA3Ljg3MTUgMi44Mjg2OSA3Ljg3Mjg1IDIuODMwNTRDNy44NzU1NCAyLjgzNDIzIDcuODc5MjIgMi44MzkyNCA3Ljg4Mzg1IDIuODQ1NTNDNy44OTMxIDIuODU4MTEgNy45MDYxOSAyLjg3NTgyIDcuOTIyOTggMi44OTgzN0M3Ljk1NjU2IDIuOTQzNDUgOC4wMDQ5OSAzLjAwNzkyIDguMDY3MyAzLjA4OTQ0QzguMTkxODUgMy4yNTIzOSA4LjM3MjE3IDMuNDgzODcgOC42MDAzOCAzLjc2NTA2QzkuMDU1OTMgNC4zMjYzNSA5LjcwNjg1IDUuMDkxMjggMTAuNDkgNS45MDcwNUMxMi4wMTU4IDcuNDk2NCAxNC4xOTc3IDkuNDQ0MzUgMTYuNTA4NCAxMC4zMTA5TDE3LjQ5MTYgNy42ODkxNFpNNy42MTM5NyAyLjE5ODAxQzguMTA2NjkgNS42NDY2OSA4LjM0OTk3IDguODI5MjYgOC4zNDk5NyAxMS41QzguMzQ5OTcgMTQuMjAxNSA4LjEwMDE0IDE2LjI3MjIgNy42NzE3NSAxNy41NTcyTDEwLjMyOCAxOC40NDI4QzEwLjg5OTggMTYuNzI3OCAxMS4xNSAxNC4yOTg2IDExLjE1IDExLjVDMTEuMTUgOC42NzA3NiAxMC44OTMyIDUuMzUzMzEgMTAuMzg1OCAxLjgwMTk5TDcuNjEzOTcgMi4xOTgwMVpNMi45MDAzNyAxMC4wNzIxQzMuODgyMjggOS4yNDc0MiA1LjI5NjM2IDguMDkwMzMgNi42NDM3OSA2LjgzMDFDNy45NzY2NCA1LjU4MzUyIDkuMzQ1ODcgNC4xNDQ1OCAxMC4yMDA0IDIuNzIwMjZMNy43OTkzOCAxLjI3OTc0QzcuMTU0MDIgMi4zNTU0MiA2LjAyMzMxIDMuNTc2NjMgNC43MzExOCA0Ljc4NTEzQzMuNDUzNjQgNS45Nzk5OCAyLjExNzcyIDcuMDcyODkgMS4wOTk2MyA3LjkyNzkzTDIuOTAwMzcgMTAuMDcyMVoiIGZpbGw9IiMzMzMyMkUiLz4KPC9zdmc+Cg=="
                                            alt="Finish"></div>


                                </div>
                            </div>
                        </template>
                    </div>

                    <div class="sort-controls" v-if="todos.length">
                        <span>Sắp xếp theo:</span>
                        <select v-model="sortBy" @change="applySorting">
                            <option value="dueDate">Ngày hết hạn gần nhất</option>
                            <option value="priority">Mức độ ưu tiên cao nhất</option>
                            <option value="progress">Tiến độ % hoàn thành ít nhất</option>
                        </select>
                    </div>

                    <ul v-if="!todos.length && showEmptyTips" class="empty-tips">
                        <li>Thêm công việc đầu tiên của bạn! 📝</li>
                        <li>Mẹo sử dụng 💡:</li>
                        <li>✔️ Nhấn Enter để thực hiện hành động.</li>
                        <li>✔️ Kéo để sắp xếp lại các việc cần làm (chỉ trên PC)</li>
                        <li>✔️ Nhấp đúp để chỉnh sửa khẩu hiệu và công việc.</li>
                        <li>✔️ Truy cập các tác vụ nhanh ở thanh bên phải.</li>
                        <li>🔒 Dữ liệu của bạn được lưu trữ cục bộ trong trình duyệt.</li>
                        <li>📝 Hỗ trợ tải xuống và nhập dữ liệu.</li>
                    </ul>


                    <transition-group name="drag" class="todo-list" tag="ul" mode="in-out" @before-enter="beforeEnter"
                        @enter="enter" @after-enter="afterEnter" :css="false" appear="appear">

                        <li v-for='(todo, index) in filteredTodos' :key='todo.id' class='todo-item'
                            @dragenter="dragenter($event, index)" @dragover="dragover($event, index)"
                            @dragstart="dragstart(index)" :data-delay="index * 150 * delayTime" v-show="show"
                            :draggable="!(editedTodo !== null && editedTodo.id === todo.id)" :class="{'priority-high': todo.priority === 'high', 
                                    'priority-medium': todo.priority === 'medium', 
                                    'priority-low': todo.priority === 'low'}">
                            <div class="todo-content" :class="{
                                    'completed': todo.completed,
                                    'overdue': isOverdue(todo) && !todo.completed
                                }" @click.stop="viewTaskDetail(todo)">

                                {{todo.title}}
                            </div>
                            <div class="task-progress-bar-container" v-if="!todo.removed" :class="{
                                    'task-progress-low': (todo.progress || 0) <= 30,
                                    'task-progress-medium': (todo.progress || 0) > 30 && (todo.progress || 0) <= 70,
                                    'task-progress-high': (todo.progress || 0) > 70
                                }">
                                <div class="task-progress-bar" :style="{ width: (todo.progress || 0) + '%' }"></div>
                                <span class="task-progress-text">{{todo.progress || 0}}%</span>
                            </div>
                            <div class="todo-btn btn-finish" v-if="!todo.completed" @click="markAsCompleted(todo)">
                            </div>
                            <div class="todo-btn btn-unfinish" v-if="todo.completed" @click="markAsUncompleted(todo)">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIuMzYzMTcgOS42NzUwNkMxLjU1OTM5IDkuNDc0NDkgMC43NDUyMDQgOS45NjM0OCAwLjU0NDYyOSAxMC43NjczQzAuMzQ0MDU0IDExLjU3MSAwLjgzMzA0NyAxMi4zODUyIDEuNjM2ODMgMTIuNTg1OEwyLjM2MzE3IDkuNjc1MDZaTTguMTU4NzMgMTZMNi43ODA0MSAxNi41OTE4QzcuMDMwOTggMTcuMTc1NCA3LjYyMTk1IDE3LjUzNzkgOC4yNTU3NSAxNy40OTY5QzguODg5NTQgMTcuNDU1OCA5LjQyODc3IDE3LjAyIDkuNjAxOTEgMTYuNDA4OUw4LjE1ODczIDE2Wk0yMi4zMjYxIDMuNDY0MTNDMjMuMTM0NyAzLjI4NDA2IDIzLjY0NDIgMi40ODI1NyAyMy40NjQxIDEuNjczOTVDMjMuMjg0MSAwLjg2NTMyOCAyMi40ODI2IDAuMzU1NzkxIDIxLjY3MzkgMC41MzU4NjZMMjIuMzI2MSAzLjQ2NDEzWk0xLjYzNjgzIDEyLjU4NThDMi4wMjc2NCAxMi42ODMzIDMuMTIyOTkgMTMuMTUxIDQuMjc3OCAxMy45NDI2QzUuNDM5ODggMTQuNzM5MyA2LjM4OTA2IDE1LjY4MDMgNi43ODA0MSAxNi41OTE4TDkuNTM3MDUgMTUuNDA4MkM4LjgxMDk0IDEzLjcxNzEgNy4zMDE1NyAxMi4zNzgzIDUuOTc0MDYgMTEuNDY4MkM0LjYzOTI3IDEwLjU1MzIgMy4yMTM5OSA5Ljg4NzM4IDIuMzYzMTcgOS42NzUwNkwxLjYzNjgzIDEyLjU4NThaTTkuNjAxOTEgMTYuNDA4OUMxMC4xMzU5IDE0LjUyNDQgMTEuNDk0OCAxMS42NTg1IDEzLjY3MjcgOS4wNjM5NUMxNS44NDQ1IDYuNDc2NzUgMTguNzQxNyA0LjI2MjM1IDIyLjMyNjEgMy40NjQxM0wyMS42NzM5IDAuNTM1ODY2QzE3LjI1ODMgMS41MTkyIDEzLjgyNzUgNC4yMTM0MiAxMS4zNzQ5IDcuMTM1MTRDOC45Mjg1MiAxMC4wNDk1IDcuMzY2NzQgMTMuMjkyOSA2LjcxNTU1IDE1LjU5MTFMOS42MDE5MSAxNi40MDg5WiIgZmlsbD0iIzMzMzIyRSIvPgo8L3N2Zz4K"
                                    alt="Mark as Incomplete" class="icon-finish" draggable="false">
                            </div>
                            <div v-if="todo.removed" class="todo-btn btn-restore" @click="restoreTodo(todo)">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTkiIHZpZXdCb3g9IjAgMCAxOSAxOSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTcuMzQ3OTggMi42NTc5MkM3LjcxMTM0IDEuOTEzNDQgNy40MDIzOCAxLjAxNTM1IDYuNjU3OSAwLjY1MTk4OEM1LjkxMzQxIDAuMjg4NjI3IDUuMDE1MzIgMC41OTc1OSA0LjY1MTk2IDEuMzQyMDhMNy4zNDc5OCAyLjY1NzkyWk0xLjUyNiA5LjA4MzMzTDAuMzc1NTcxIDguMTIwNzhDMC4wNzc5NTE2IDguNDc2NDkgLTAuMDM4MzgyIDguOTQ5ODcgMC4wNjA0NjEyIDkuNDAzMDFDMC4xNTkzMDQgOS44NTYxNSAwLjQ2MjIwNiAxMC4yMzgxIDAuODgwOTI0IDEwLjQzNzVMMS41MjYgOS4wODMzM1pNMTQuNTcyNCAxNi41ODkzQzE0LjM0NTYgMTcuMzg2IDE0LjgwNzYgMTguMjE1OCAxNS42MDQ0IDE4LjQ0MjZDMTYuNDAxMiAxOC42Njk0IDE3LjIzMSAxOC4yMDczIDE3LjQ1NzggMTcuNDEwNkwxNC41NzI0IDE2LjU4OTNaTTYuMjUxOTIgMTQuMzMyMUM2LjcxMTQ1IDE1LjAyMTMgNy42NDI3NiAxNS4yMDc2IDguMzMyMDUgMTQuNzQ4MUM5LjAyMTM0IDE0LjI4ODUgOS4yMDc2IDEzLjM1NzIgOC43NDgwOCAxMi42Njc5TDYuMjUxOTIgMTQuMzMyMVpNNC42NTE5NiAxLjM0MjA4QzMuNjc2NiAzLjM0MDQ3IDIuNjAwMzMgNS4wNDUyNSAxLjc2NjU4IDYuMjUxMDhDMS4zNTA1OSA2Ljg1MjcyIDAuOTk3MjYzIDcuMzI2ODUgMC43NTAzODQgNy42NDc2MkMwLjYyNzAwNSA3LjgwNzkzIDAuNTMwMzkyIDcuOTI5NyAwLjQ2NjA0NyA4LjAwOTY5QzAuNDMzODggOC4wNDk2NyAwLjQwOTc5NiA4LjA3OTIgMC4zOTQ0ODIgOC4wOTc4NkMwLjM4NjgyNiA4LjEwNzE4IDAuMzgxMzY0IDguMTEzNzkgMC4zNzgxODMgOC4xMTc2M0MwLjM3NjU5MiA4LjExOTU1IDAuMzc1NTcyIDguMTIwNzcgMC4zNzUxMzMgOC4xMjEzQzAuMzc0OTE0IDguMTIxNTcgMC4zNzQ4NCA4LjEyMTY1IDAuMzc0OTEyIDguMTIxNTdDMC4zNzQ5NDggOC4xMjE1MiAwLjM3NTAyMSA4LjEyMTQ0IDAuMzc1MTMxIDguMTIxM0MwLjM3NTE4NiA4LjEyMTI0IDAuMzc1Mjk2IDguMTIxMTEgMC4zNzUzMjMgOC4xMjEwN0MwLjM3NTQ0MiA4LjEyMDkzIDAuMzc1NTcxIDguMTIwNzggMS41MjYgOS4wODMzM0MyLjY3NjQzIDEwLjA0NTkgMi42NzY1OCAxMC4wNDU3IDIuNjc2NzMgMTAuMDQ1NUMyLjY3NjggMTAuMDQ1NCAyLjY3Njk2IDEwLjA0NTIgMi42NzcwOSAxMC4wNDUxQzIuNjc3MzUgMTAuMDQ0OCAyLjY3NzY1IDEwLjA0NDQgMi42Nzc5OCAxMC4wNDRDMi42Nzg2NSAxMC4wNDMyIDIuNjc5NDYgMTAuMDQyMyAyLjY4MDQyIDEwLjA0MTFDMi42ODIzNCAxMC4wMzg4IDIuNjg0ODYgMTAuMDM1OCAyLjY4Nzk0IDEwLjAzMkMyLjY5NDEyIDEwLjAyNDYgMi43MDI2MSAxMC4wMTQzIDIuNzEzMzMgMTAuMDAxM0MyLjczNDc1IDkuOTc1MTYgMi43NjUwOCA5LjkzNzk1IDIuODAzNjIgOS44OTAwNUMyLjg4MDY3IDkuNzk0MjYgMi45OTA2IDkuNjU1NjEgMy4xMjc3OCA5LjQ3NzM4QzMuNDAyMDEgOS4xMjEwNiAzLjc4NTg3IDguNjA1NjIgNC4yMzQxNyA3Ljk1NzI1QzUuMTI5IDYuNjYzMDggNi4yODk3MiA0LjgyNjIgNy4zNDc5OCAyLjY1NzkyTDQuNjUxOTYgMS4zNDIwOFpNMi4wNDcwNCAxMC40ODk5QzMuNzc2MTcgOS44NDk0MiA1LjczMzE5IDkuMTcyMzEgNy42MzggOC43MjEzN0M5LjU3MDA4IDguMjYzOTkgMTEuMzAyNSA4LjA3NjMxIDEyLjYyODggOC4zMDE3QzEzLjg3NTIgOC41MTM1MiAxNC42Mjg0IDkuMDUwMDggMTUuMDE2MyAxMC4wNDA1QzE1LjQ2MjggMTEuMTgwNyAxNS41MzgzIDEzLjE5NTYgMTQuNTcyNCAxNi41ODkzTDE3LjQ1NzggMTcuNDEwNkMxOC40ODQzIDEzLjgwNDIgMTguNjE2NiAxMS4wMDY3IDE3LjgwOTcgOC45NDY0NkMxNi45NDQyIDYuNzM2MzQgMTUuMTMzNyA1LjY4NDM3IDEzLjEzMTQgNS4zNDQxMUMxMS4yMDkyIDUuMDE3NDMgOS4wMDc5OSA1LjMxNDEzIDYuOTQ2OSA1LjgwMjA2QzQuODU4NTYgNi4yOTY0NCAyLjc2MjgzIDcuMDI1NTggMS4wMDQ5NiA3LjY3NjczTDIuMDQ3MDQgMTAuNDg5OVpNOC43NDgwOCAxMi42Njc5QzcuNTIzMTIgMTAuODMwNSA1LjIyOTM0IDkuMTg1OTMgMi4xNzEwOCA3LjcyOTEzTDAuODgwOTI0IDEwLjQzNzVDMy43NzA2NiAxMS44MTQxIDUuNDc2ODggMTMuMTY5NSA2LjI1MTkyIDE0LjMzMjFMOC43NDgwOCAxMi42Njc5WiIgZmlsbD0iIzMzMzIyRSIvPgo8L3N2Zz4K"
                                    alt="Restore" draggable="false">
                            </div>
                            <div class="todo-btn btn-delete" v-else="todo.removed" @click="removeTodo(todo)">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNS4wOTkzIDE3Ljc1OTdDMTUuNzk0OSAxOC4yMDk4IDE2LjcyMzUgMTguMDEwOCAxNy4xNzM2IDE3LjMxNTJDMTcuNjIzNiAxNi42MTk3IDE3LjQyNDYgMTUuNjkxMSAxNi43MjkxIDE1LjI0MUMxMy4zMDc5IDEzLjAyNzMgMTAuODIwOSAxMC45OTU5IDguOTIyNTEgOS4wMzczOUM5LjA5NzQyIDguODQ5ODIgOS4yNzI5MSA4LjY2NTcxIDkuNDQ4ODggOC40ODUzNEMxMS44ODY0IDUuOTg2OTIgMTQuMjQ3MiA0LjM4MDY2IDE2LjI5NDQgMy45NzEyMkMxNy4xMDY3IDMuODA4NzUgMTcuNjMzNSAzLjAxODUyIDE3LjQ3MTEgMi4yMDYxOEMxNy4zMDg2IDEuMzkzODQgMTYuNTE4NCAwLjg2NzAxMyAxNS43MDYgMS4wMjk0OEMxMi43NTMyIDEuNjIwMDUgOS44NjQwNiAzLjc2Mzc5IDcuMzAxNTQgNi4zOTAzN0M3LjE4MTUxIDYuNTEzNCA3LjA2MTgxIDYuNjM3ODkgNi45NDI0OSA2Ljc2Mzc1QzUuNDIwMDEgNC44MDQzMyA0LjM3MDU4IDIuODc2MzIgMy40MjU5MSAwLjg2MzE2NEMzLjA3Mzk5IDAuMTEzMjAyIDIuMTgwNzMgLTAuMjA5NDc1IDEuNDMwNzcgMC4xNDI0NDVDMC42ODA4MDkgMC40OTQzNjUgMC4zNTgxMzIgMS4zODc2MiAwLjcxMDA1MSAyLjEzNzU4QzEuODIwODggNC41MDQ4MSAzLjA3ODk5IDYuNzY1MTEgNC45MjkzMiA5LjA1MzA2QzMuMjIyMDYgMTEuMTM0MSAxLjYyNjY5IDEzLjQzMjggMC4yMjI3MjMgMTUuNzE0MkMtMC4yMTE0NTMgMTYuNDE5NyAwLjAwODUyNzUyIDE3LjM0MzcgMC43MTQwNjQgMTcuNzc3OEMxLjQxOTYgMTguMjEyIDIuMzQzNTIgMTcuOTkyIDIuNzc3NyAxNy4yODY1QzQuMDQ4MTkgMTUuMjIyIDUuNDY0MDUgMTMuMTcyNiA2Ljk1NTU5IDExLjMxNjhDOC45ODUgMTMuMzc2NSAxMS41OTU5IDE1LjQ5MjggMTUuMDk5MyAxNy43NTk3WiIgZmlsbD0iIzMzMzIyRSIvPgo8L3N2Zz4K"
                                    alt="Delete" draggable="false">
                            </div>

                            <div class="edit-todo-wrapper" v-if="editedTodo !== null && editedTodo.id === todo.id">
                                <input type="text" class="edit-todo" value="Edit Todo..."
                                    v-if="editedTodo !== null && editedTodo.id === todo.id" v-model="todo.title"
                                    v-focus="true" @keyup.enter="editDone(todo)" @keyup.esc="cancelEdit(todo)"
                                    @dragstart.stop.prevent @mousedown.stop />
                                <div class="todo-btn btn-edit-submit" @click="editDone(todo)">
                                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAxOSAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE2LjUwODQgMTAuMzEwOUMxNy4yMzI0IDEwLjU4MjMgMTguMDM5NCAxMC4yMTU1IDE4LjMxMDkgOS40OTE1N0MxOC41ODIzIDguNzY3NiAxOC4yMTU1IDcuOTYwNjMgMTcuNDkxNiA3LjY4OTE0TDE2LjUwODQgMTAuMzEwOVpNOC45OTk5IDJMMTAuMTMyMSAxLjE3NjU1QzkuODU1OCAwLjc5NjYxOCA5LjQwNzM1IDAuNTgwNjA1IDguOTM4MDIgMC42MDEzNjhDOC40Njg3IDAuNjIyMTMgOC4wNDEwNyAwLjg3Njg5OSA3Ljc5OTM4IDEuMjc5NzRMOC45OTk5IDJaTTcuNjcxNzUgMTcuNTU3MkM3LjQyNzIyIDE4LjI5MDcgNy44MjM2MiAxOS4wODM2IDguNTU3MTMgMTkuMzI4MUM5LjI5MDY0IDE5LjU3MjcgMTAuMDgzNSAxOS4xNzYzIDEwLjMyOCAxOC40NDI4TDcuNjcxNzUgMTcuNTU3MlpNMS4wOTk2MyA3LjkyNzkzQzAuNTA3NTQxIDguNDI1MTkgMC40MzA2NjkgOS4zMDgyOCAwLjkyNzkzMSA5LjkwMDM3QzEuNDI1MTkgMTAuNDkyNSAyLjMwODI4IDEwLjU2OTMgMi45MDAzNyAxMC4wNzIxTDEuMDk5NjMgNy45Mjc5M1pNMTcuNDkxNiA3LjY4OTE0QzE1LjgwMjMgNy4wNTU2NSAxMy45ODQxIDUuNTAzNiAxMi41MDk5IDMuOTY3OTVDMTEuNzkzIDMuMjIxMjIgMTEuMTkzOSAyLjUxNzQgMTAuNzc0NCAyLjAwMDU2QzEwLjU2NTEgMS43NDI2OSAxMC40MDE3IDEuNTMyNzYgMTAuMjkxOSAxLjM4OTA4QzEwLjIzNyAxLjMxNzI3IDEwLjE5NTYgMS4yNjIxMSAxMC4xNjg2IDEuMjI1OUMxMC4xNTUxIDEuMjA3OCAxMC4xNDUzIDEuMTk0NDQgMTAuMTM5MSAxLjE4NjEyQzEwLjEzNjEgMS4xODE5NSAxMC4xMzQgMS4xNzkwNSAxMC4xMzI4IDEuMTc3NDRDMTAuMTMyMiAxLjE3NjY0IDEwLjEzMTggMS4xNzYxNiAxMC4xMzE3IDEuMTc2MDFDMTAuMTMxNyAxLjE3NTkzIDEwLjEzMTcgMS4xNzU5NCAxMC4xMzE3IDEuMTc2MDNDMTAuMTMxOCAxLjE3NjA3IDEwLjEzMTkgMS4xNzYyIDEwLjEzMTkgMS4xNzYyM0MxMC4xMzIgMS4xNzYzNyAxMC4xMzIxIDEuMTc2NTUgOC45OTk5IDJDNy44Njc2NyAyLjgyMzQ1IDcuODY3ODMgMi44MjM2NyA3Ljg2OCAyLjgyMzlDNy44NjgwOCAyLjgyNDAxIDcuODY4MjYgMi44MjQyNiA3Ljg2ODQyIDIuODI0NDdDNy44Njg3MiAyLjgyNDkgNy44NjkwOSAyLjgyNTQgNy44Njk1MyAyLjgyNTk5QzcuODcwMzkgMi44MjcxOCA3Ljg3MTUgMi44Mjg2OSA3Ljg3Mjg1IDIuODMwNTRDNy44NzU1NCAyLjgzNDIzIDcuODc5MjIgMi44MzkyNCA3Ljg4Mzg1IDIuODQ1NTNDNy44OTMxIDIuODU4MTEgNy45MDYxOSAyLjg3NTgyIDcuOTIyOTggMi44OTgzN0M3Ljk1NjU2IDIuOTQzNDUgOC4wMDQ5OSAzLjAwNzkyIDguMDY3MyAzLjA4OTQ0QzguMTkxODUgMy4yNTIzOSA4LjM3MjE3IDMuNDgzODcgOC42MDAzOCAzLjc2NTA2QzkuMDU1OTMgNC4zMjYzNSA5LjcwNjg1IDUuMDkxMjggMTAuNDkgNS45MDcwNUMxMi4wMTU4IDcuNDk2NCAxNC4xOTc3IDkuNDQ0MzUgMTYuNTA4NCAxMC4zMTA5TDE3LjQ5MTYgNy42ODkxNFpNNy42MTM5NyAyLjE5ODAxQzguMTA2NjkgNS42NDY2OSA4LjM0OTk3IDguODI5MjYgOC4zNDk5NyAxMS41QzguMzQ5OTcgMTQuMjAxNSA4LjEwMDE0IDE2LjI3MjIgNy42NzE3NSAxNy41NTcyTDEwLjMyOCAxOC40NDI4QzEwLjg5OTggMTYuNzI3OCAxMS4xNSAxNC4yOTg2IDExLjE1IDExLjVDMTEuMTUgOC42NzA3NiAxMC44OTMyIDUuMzUzMzEgMTAuMzg1OCAxLjgwMTk5TDcuNjEzOTcgMi4xOTgwMVpNMi45MDAzNyAxMC4wNzIxQzMuODgyMjggOS4yNDc0MiA1LjI5NjM2IDguMDkwMzMgNi42NDM3OSA2LjgzMDFDNy45NzY2NCA1LjU4MzUyIDkuMzQ1ODcgNC4xNDQ1OCAxMC4yMDA0IDIuNzIwMjZMNy43OTkzOCAxLjI3OTc0QzcuMTU0MDIgMi4zNTU0MiA2LjAyMzMxIDMuNTc2NjMgNC43MzExOCA0Ljc4NTEzQzMuNDUzNjQgNS45Nzk5OCAyLjExNzcyIDcuMDcyODkgMS4wOTk2MyA3LjkyNzkzTDIuOTAwMzcgMTAuMDcyMVoiIGZpbGw9IiMzMzMyMkUiLz4KPC9zdmc+Cg=="
                                        alt="提交" draggable="false">
                                </div>
                            </div>
                        </li>
                    </transition-group>
                    <div class="bar-message bar-bottom">
                        <div class="bar-message-text">
                            <span v-if="leftTodosCount">{{leftTodosCount}} công việc còn lại</span>
                            <span v-else-if="completedTodosCount">Tất cả đã hoàn thành, làm tốt lắm!</span>
                        </div>
                    </div>
                </div>

                <div class="footer side-bar">
                    <div class="side-shortcut" @click="shortCutAction()" :class="{fold: isShow}">
                        <div class="shortcut-switch">
                            <span class="shortcut-title">{{shortCut}}</span>
                            <span class="shortcut-name">Quicks
                            </span>
                        </div>

                    </div>
                    <div class="todo-footer-box">
                        <ul class="todo-func-list filter">
                            <li>
                                <input class="btn-small action-showAll" type="button" value="Tất cả"
                                    :class="{selected: intention === 'all'}" @click="intention ='all'">
                            </li>
                            <li v-if="completedTodosCount"><input class="btn-small action-progress" type="button"
                                    value="Đang thực hiện" v-if="leftTodosCount"
                                    :class="{selected: intention === 'ongoing'}" @click="intention ='ongoing'"></li>
                            <li v-if="completedTodosCount">
                                <input class="btn-small action-completed" type="button" value="Đã hoàn thành"
                                    v-if="completedTodosCount" :class="{selected: intention === 'completed'}"
                                    @click="intention='completed'">
                            </li>
                            <li v-if="recycleBin.length">
                                <input class="btn-small action-deleted" type="button" v-if="recycleBin.length"
                                    :class="{selected: intention === 'removed'}" value="Thùng rác"
                                    @click="intention='removed'" />
                            </li>
                        </ul>
                        <ul class="todo-func-list batch">
                            <li v-if="leftTodosCount">
                                <input type="button" class="btn-small completed-all" v-if="leftTodosCount"
                                    value="Hoàn thành tất cả" @click="markAllAsCompleted">
                            </li>
                            <li v-if="completedTodosCount">
                                <input type="button" value="Xóa đã hoàn thành" class="btn-small completed-clear"
                                    v-if="completedTodosCount" @click="clearCompleted">
                            </li>
                            <li v-if="todos.length"><input type="button" class="btn-small clear-all" value="Xóa tất cả"
                                    @click="clearAll">
                            </li>
                        </ul>
                        <ul class="todo-func-list datasave">
                            <li v-if="leftTodosCount">
                                <input type="button" value="Xuất dữ liệu" class="btn-small action-download"
                                    id="download" onclick="handleClickDownload()"></input>
                            </li>
                            <li>
                                <input value="Nhập dữ liệu (txt/json)" type="button" class="btn-small action-import"
                                    id="import" />
                            </li>
                        </ul>

                    </div>

                </div>
            </div>

            <!-- Reminder Notification -->
            <div class="reminder-notification" v-if="showReminders && upcomingTasks.length > 0">
                <div class="reminder-header">
                    <span>Công việc sắp đến hạn</span>
                    <span class="close-btn" @click="showReminders = false">×</span>
                </div>
                <div class="reminder-body">
                    <div class="reminder-item" v-for="task in upcomingTasks" :key="task.id"
                        @click.stop="viewTaskDetail(task)" style="cursor:pointer">
                        <div class="task-name">{{ task.title }}</div>
                        <div class="days-left" :class="{ 'warning': getDaysLeft(task) > 2 }">
                            <span v-if="getDaysLeft(task) === 0">Đến hạn hôm nay!</span>
                            <span v-else-if="getDaysLeft(task) === 1">Còn 1 ngày</span>
                            <span v-else>Còn {{ getDaysLeft(task) }} ngày</span>
                        </div>
                    </div>
                </div>
                <div class="reminder-footer">
                    <span>Nhấp vào công việc để xem chi tiết</span>
                </div>
            </div>

            <!-- Task Detail Popup -->
            <div class="task-detail-popup" v-if="selectedTask" @click.self="closeTaskDetail">
                <div class="task-detail-content">
                    <div class="task-detail-header">
                        <h3>Chi tiết công việc</h3>
                        <div class="task-detail-close" @click="closeTaskDetail">×</div>
                    </div>
                    <div class="task-detail-body">
                        <div class="task-detail-item">
                            <div class="task-detail-label">Tên công việc:</div>
                            <div class="task-detail-value">{{ selectedTask.title }}</div>
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Ngày bắt đầu:</div>
                            <div class="task-detail-value">{{ selectedTask.startDate || 'Chưa thiết lập' }}</div>
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Ngày kết thúc:</div>
                            <div class="task-detail-value">{{ selectedTask.endDate || 'Chưa thiết lập' }}</div>
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Mô tả công việc:</div>
                            <div class="task-detail-value">{{ selectedTask.description || 'Không có mô tả' }}</div>
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Tiến độ công việc:</div>
                            <div class="task-detail-value">
                                <div class="progress-bar-container">
                                    <div class="progress-bar" :style="{ width: selectedTask.progress + '%' }"></div>
                                    <span class="progress-text">{{ selectedTask.progress }}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Trạng thái:</div>
                            <div class="task-detail-value">{{ selectedTask.completed ? 'Hoàn thành' : 'Đang thực hiện'
                                }}</div>
                        </div>

                        <div class="task-detail-item">
                            <div class="task-detail-label">Mức độ ưu tiên:</div>
                            <div class="task-detail-value">
                                <span v-if="selectedTask.priority === 'high'" style="color: #ff5252;">Cao</span>
                                <span v-else-if="selectedTask.priority === 'medium'" style="color: #ffc107;">Trung
                                    bình</span>
                                <span v-else-if="selectedTask.priority === 'low'" style="color: #8bc34a;">Thấp</span>
                                <span v-else>Không xác định</span>
                            </div>
                        </div>

                        <!-- Subtasks Section -->
                        <div class="task-detail-subtasks">
                            <div class="subtasks-header">
                                <h4>Công việc con</h4>
                                <button class="btn-add-subtask" @click="showAddSubtask = true">+ Thêm</button>
                            </div>

                            <!-- Add Subtask Form -->
                            <div class="add-subtask-form" v-if="showAddSubtask">
                                <input type="text" v-model="newSubtaskTitle" placeholder="Tên công việc con..."
                                    class="subtask-input">
                                <div class="subtask-form-actions">
                                    <button class="btn-save-subtask" @click="addSubtask">Lưu</button>
                                    <button class="btn-cancel-subtask" @click="showAddSubtask = false">Hủy</button>
                                </div>
                            </div>

                            <!-- Subtasks List -->
                            <div class="subtasks-list" v-if="selectedTask.subtasks && selectedTask.subtasks.length > 0">
                                <div class="subtask-item" v-for="(subtask, index) in selectedTask.subtasks"
                                    :key="index">
                                    <div class="subtask-header">
                                        <input type="checkbox" v-model="subtask.completed" @change="updateTaskProgress">
                                        <span class="subtask-title" :class="{ 'completed': subtask.completed }">{{
                                            subtask.title }}</span>
                                        <div class="subtask-actions">
                                            <button class="btn-edit-subtask" @click="editSubtask(subtask)">✎</button>
                                            <button class="btn-delete-subtask" @click="deleteSubtask(index)">×</button>
                                        </div>
                                    </div>
                                    <div class="subtask-details" v-if="subtask.showDetails">
                                        <div class="subtask-detail-row">
                                            <div class="subtask-detail-label">Ngày bắt đầu:</div>
                                            <div class="subtask-detail-value">{{ subtask.startDate || 'Chưa thiết lập'
                                                }}</div>
                                        </div>
                                        <div class="subtask-detail-row">
                                            <div class="subtask-detail-label">Ngày kết thúc:</div>
                                            <div class="subtask-detail-value">{{ subtask.endDate || 'Chưa thiết lập' }}
                                            </div>
                                        </div>
                                        <div class="subtask-detail-row" v-if="subtask.description">
                                            <div class="subtask-detail-label">Mô tả:</div>
                                            <div class="subtask-detail-value">{{ subtask.description }}</div>
                                        </div>
                                    </div>
                                    <div class="subtask-toggle" @click="toggleSubtaskDetails(subtask)">
                                        {{ subtask.showDetails ? '▲ Thu gọn' : '▼ Xem thêm' }}
                                    </div>
                                </div>
                            </div>
                            <div v-else class="no-subtasks">Chưa có công việc con</div>
                        </div>
                    </div>
                    <div class="task-detail-actions">
                        <button class="btn task-detail-btn" @click="editTaskDetail">Sửa</button>
                        <button class="btn task-detail-btn" @click="closeTaskDetail">Đóng</button>
                    </div>
                </div>
            </div>

            <!-- Edit Task Detail Popup -->
            <div class="task-detail-popup" v-if="editingTask" @click.self="cancelEditTaskDetail">
                <div class="task-detail-content">
                    <div class="task-detail-header">
                        <h3>Sửa công việc</h3>
                        <div class="task-detail-close" @click="cancelEditTaskDetail">×</div>
                    </div>
                    <div class="task-detail-body">
                        <div class="task-detail-item">
                            <div class="task-detail-label">Tên công việc:</div>
                            <input type="text" class="task-detail-input" v-model="editingTask.title">
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Ngày bắt đầu:</div>
                            <input type="date" class="task-detail-input" v-model="editingTask.startDate">
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Ngày kết thúc:</div>
                            <input type="date" class="task-detail-input" v-model="editingTask.endDate">
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Mô tả công việc:</div>
                            <textarea class="task-detail-textarea" v-model="editingTask.description"></textarea>
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Tiến độ công việc:</div>
                            <div class="task-detail-value">
                                <input type="range" min="0" max="100" class="progress-slider"
                                    v-model.number="editingTask.progress">
                                <div class="progress-bar-container">
                                    <div class="progress-bar" :style="{ width: editingTask.progress + '%' }"></div>
                                    <span class="progress-text">{{ editingTask.progress }}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Trạng thái:</div>
                            <div class="task-detail-value">
                                <select v-model="editingTask.completed" class="task-detail-select">
                                    <option :value="false">Đang thực hiện</option>
                                    <option :value="true">Đã hoàn thành</option>
                                </select>
                            </div>
                        </div>

                        <div class="task-detail-item">
                            <div class="task-detail-label">Mức độ ưu tiên:</div>
                            <div class="task-detail-value">
                                <select v-model="editingTask.priority" class="task-detail-select">
                                    <option value="low">Thấp</option>
                                    <option value="medium">Trung bình</option>
                                    <option value="high">Cao</option>
                                </select>
                            </div>
                        </div>

                        <!-- Edit Subtasks Section -->
                        <div class="task-detail-subtasks">
                            <div class="subtasks-header">
                                <h4>Công việc con</h4>
                                <button class="btn-add-subtask" @click="showEditSubtask = true">+ Thêm</button>
                            </div>

                            <!-- Add Subtask Form in Edit Mode -->
                            <div class="add-subtask-form" v-if="showEditSubtask">
                                <input type="text" v-model="newSubtaskTitle" placeholder="Tên công việc con..."
                                    class="subtask-input">
                                <div class="subtask-form-actions">
                                    <button class="btn-save-subtask" @click="addSubtaskToEdit">Lưu</button>
                                    <button class="btn-cancel-subtask" @click="showEditSubtask = false">Hủy</button>
                                </div>
                            </div>

                            <!-- Subtasks List in Edit Mode -->
                            <div class="subtasks-list" v-if="editingTask.subtasks && editingTask.subtasks.length > 0">
                                <div class="subtask-item" v-for="(subtask, index) in editingTask.subtasks" :key="index">
                                    <input type="checkbox" v-model="subtask.completed">
                                    <input type="text" class="subtask-edit-input" v-model="subtask.title">
                                    <button class="btn-delete-subtask" @click="deleteSubtaskFromEdit(index)">×</button>
                                </div>
                            </div>
                            <div v-else class="no-subtasks">Chưa có công việc con</div>
                        </div>
                    </div>
                    <div class="task-detail-actions">
                        <button class="btn task-detail-btn" @click="saveTaskDetail">Lưu</button>
                        <button class="btn task-detail-btn" @click="cancelEditTaskDetail">Hủy</button>
                    </div>
                </div>
            </div>

            <!-- Advanced Add Task Modal -->
            <div class="task-detail-popup" v-if="showAdvancedAdd" @click.self="cancelAdvancedAdd">
                <div class="task-detail-content">
                    <div class="task-detail-header">
                        <h3>Thêm công việc</h3>
                        <div class="task-detail-close" @click="cancelAdvancedAdd">×</div>
                    </div>
                    <div class="task-detail-body">
                        <div class="task-detail-item">
                            <div class="task-detail-label">Tên công việc:</div>
                            <input type="text" class="task-detail-input" v-model="advancedTodo.title">
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Ngày bắt đầu:</div>
                            <input type="date" class="task-detail-input" v-model="advancedTodo.startDate">
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Ngày kết thúc:</div>
                            <input type="date" class="task-detail-input" v-model="advancedTodo.endDate">
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Mô tả công việc:</div>
                            <textarea class="task-detail-textarea" v-model="advancedTodo.description"></textarea>
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Tiến độ công việc:</div>
                            <div class="task-detail-value">
                                <input type="range" min="0" max="100" class="progress-slider"
                                    v-model.number="advancedTodo.progress">
                                <div class="progress-bar-container">
                                    <div class="progress-bar" :style="{ width: advancedTodo.progress + '%' }"></div>
                                    <span class="progress-text">{{ advancedTodo.progress }}%</span>
                                </div>
                            </div>
                        </div>

                        <div class="task-detail-item">
                            <div class="task-detail-label">Mức độ ưu tiên:</div>
                            <div class="task-detail-value">
                                <select v-model="advancedTodo.priority" class="task-detail-select">
                                    <option value="low">Thấp</option>
                                    <option value="medium">Trung bình</option>
                                    <option value="high">Cao</option>
                                </select>
                            </div>
                        </div>

                        <!-- Subtasks Section -->
                        <div class="task-detail-subtasks">
                            <div class="subtasks-header">
                                <h4>Công việc con</h4>
                                <button class="btn-add-subtask" @click="showAddAdvancedSubtask = true">+ Thêm</button>
                            </div>

                            <!-- Add Subtask Form -->
                            <div class="add-subtask-form" v-if="showAddAdvancedSubtask">
                                <input type="text" v-model="newSubtaskTitle" placeholder="Tên công việc con..."
                                    class="subtask-input">
                                <div class="subtask-form-actions">
                                    <button class="btn-save-subtask" @click="addAdvancedSubtask">Lưu</button>
                                    <button class="btn-cancel-subtask"
                                        @click="showAddAdvancedSubtask = false">Hủy</button>
                                </div>
                            </div>

                            <!-- Subtasks List -->
                            <div class="subtasks-list" v-if="advancedTodo.subtasks && advancedTodo.subtasks.length > 0">
                                <div class="subtask-item" v-for="(subtask, index) in advancedTodo.subtasks"
                                    :key="index">
                                    <input type="checkbox" v-model="subtask.completed">
                                    <input type="text" class="subtask-edit-input" v-model="subtask.title">
                                    <button class="btn-delete-subtask" @click="deleteAdvancedSubtask(index)">×</button>
                                </div>
                            </div>
                            <div v-else class="no-subtasks">Chưa có công việc con</div>
                        </div>
                    </div>
                    <div class="task-detail-actions">
                        <button class="btn task-detail-btn" @click="saveAdvancedTodo">Lưu</button>
                        <button class="btn task-detail-btn" @click="cancelAdvancedAdd">Hủy</button>
                    </div>
                </div>
            </div>

            <!-- Subtask Edit Form Popup -->
            <div class="task-detail-popup" v-if="showEditSubtaskForm" @click.self="cancelEditSubtask">
                <div class="task-detail-content">
                    <div class="task-detail-header">
                        <h3>Chỉnh sửa công việc con</h3>
                        <div class="task-detail-close" @click="cancelEditSubtask">×</div>
                    </div>
                    <div class="task-detail-body">
                        <div class="task-detail-item">
                            <div class="task-detail-label">Tên công việc con:</div>
                            <input type="text" class="task-detail-input" v-model="editingSubtask.title">
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Ngày bắt đầu:</div>
                            <input type="date" class="task-detail-input" v-model="editingSubtask.startDate">
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Ngày kết thúc:</div>
                            <input type="date" class="task-detail-input" v-model="editingSubtask.endDate">
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Mô tả công việc:</div>
                            <textarea class="task-detail-textarea" v-model="editingSubtask.description"></textarea>
                        </div>
                        <div class="task-detail-item">
                            <div class="task-detail-label">Trạng thái:</div>
                            <div class="task-detail-value">
                                <select v-model="editingSubtask.completed" class="task-detail-select">
                                    <option :value="false">Đang thực hiện</option>
                                    <option :value="true">Đã hoàn thành</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="task-detail-actions">
                        <button class="btn task-detail-btn" @click="saveEditSubtask">Lưu</button>
                        <button class="btn task-detail-btn" @click="cancelEditSubtask">Hủy</button>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <script>
        // localStorage operations
        var STORAGE_KEY = 'uiineed-todos';
        var todoStorage = {
            fetch: function () {
                var todos = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                todos.forEach(function (todo, index) {
                    todo.id = index;
                });
                todoStorage.uid = todos.length;
                return todos;
            },
            save: function (todos) {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
            }
        }
    </script>
    <script>
        // Vue instance initialization
        var app = new Vue({
            el: '#todo-app',
            data: function () {
                return {
                    todos: todoStorage.fetch() || [],

                    newTodoTitle: '',
                    editedTodo: null,
                    intention: 'all', // Default: all
                    checkEmpty: false,
                    recycleBin: [],
                    dragIndex: '',
                    enterIndex: '',
                    show: true,
                    delayTime: '1',
                    isShow: false,
                    shortCut: 'OPEN✨',
                    popShow: true,
                    windowWidth: document.documentElement.clientWidth,
                    slogan: "Act Now, Simplify Life.☕", // Default value
                    isEditing: false,
                    originalSlogan: "",
                    selectedTask: null,
                    editingTask: null,
                    showAddSubtask: false,
                    showEditSubtask: false,
                    newSubtaskTitle: '',
                    showAdvancedAdd: false,
                    advancedTodo: {
                        title: '',
                        startDate: '',
                        endDate: '',
                        description: '',
                        progress: 0,
                        subtasks: [],
                        priority: 'medium'
                    },
                    showAddAdvancedSubtask: false,
                    editingSubtask: null,
                    showEditSubtaskForm: false,
                    sortBy: 'dueDate',
                    searchQuery: '',
                    upcomingTasks: [],
                    showReminders: true
                };
            },
            watch: {
                windowWidth(val) {
                    let that = this;
                },
                todos: {
                    handler: function (todos) {
                        todoStorage.save(todos);
                    },
                    deep: true
                }
            },
            methods: {
                editText() {
                    this.originalSlogan = this.slogan;
                    this.isEditing = true;
                    this.$nextTick(() => {
                        this.$refs.sloganInput.focus();
                    });
                },

                saveText() {
                    this.isEditing = false;
                    localStorage.setItem('uiineed-slogan', this.slogan);
                },
                cancelText() {
                    this.slogan = this.originalSlogan;
                    this.isEditing = false;
                },
                getSlogan() {
                    return localStorage.getItem('uiineed-slogan') || "Act Now, Simplify Life.☕";
                },
                contorlScreen: function () {
                    if (this.windowWidth < 768) {
                        this.isShow = !this.isShow;
                        return this.shortCut = 'Filter';
                    }
                },
                togglePop: function () {
                    this.popShow = !this.popShow;
                },
                shortCutAction: function () {
                    this.isShow = !this.isShow;
                    if (this.isShow) {
                        return this.shortCut = '＝';
                    } else {
                        return this.shortCut = 'OPEN✨';
                    }
                },
                shuffle: function () {
                    this.filteredTodos = _.shuffle(this.filteredTodos);
                },
                addTodo: function (e) {
                    if (this.newTodoTitle === '') {
                        this.checkEmpty = true;
                        return;
                    }
                    this.todos.unshift({
                        id: todoStorage.uid++,
                        title: this.newTodoTitle,
                        completed: false,
                        removed: false,
                        startDate: '',
                        endDate: '',
                        description: '',
                        progress: 0, // Tiến độ công việc (0-100)
                        subtasks: [] // Danh sách công việc con

                    });
                    this.newTodoTitle = '';
                    this.checkEmpty = false;
                    this.delayTime = '0';
                },
                // markAsCompleted: function (todo) {
                //     todo.completed = true;
                // },
                // markAsUncompleted: function (todo) {
                //     todo.completed = false;
                // },
                // Sửa lại phương thức markAsCompleted
                markAsCompleted: function (todo) {
                    // Lưu lại tiến độ cũ trước khi đánh dấu hoàn thành
                    if (!todo.previousProgress) {
                        todo.previousProgress = todo.progress || 0;
                    }
                    todo.completed = true;
                    todo.progress = 100; // Set tiến độ lên 100% khi hoàn thành
                },

                // Sửa lại phương thức markAsUncompleted  
                markAsUncompleted: function (todo) {
                    todo.completed = false;
                    // Khôi phục lại tiến độ trước đó
                    todo.progress = todo.previousProgress || 0;
                    delete todo.previousProgress; // Xóa giá trị đã lưu
                },
                markAllAsCompleted: function () {
                    confirm('Confirm to mark all as completed?').then((confirmed) => {
                        if (confirmed) {
                            this.todos.map(function (todo) {
                                if (!todo.completed) todo.completed = true;
                            });
                        }
                    });
                },

                removeTodo: function (todo) {
                    let removedTodo = this.todos.splice(this.todos.indexOf(todo), 1)[0];
                    removedTodo.removed = true;
                    this.recycleBin.unshift(removedTodo);
                },
                restoreTodo: function (todo) {
                    todo.removed = false;
                    this.todos.unshift(todo);
                    let pos = this.recycleBin.indexOf(todo);
                    this.recycleBin.splice(pos, 1);
                },
                editdTodo: function (todo) {
                    this.editedTodo = {
                        id: todo.id,
                        title: todo.title
                    }
                },
                lineFeed: function (event) {
                    if (event.keyCode == 13 && event.ctrlKey) {
                        this.newTodoTitle = this.newTodoTitle + '\n';
                    } else {
                        if (this.newTodoTitle === '') {
                            this.checkEmpty = true;
                            return;
                        }
                        this.todos.unshift({
                            id: todoStorage.uid++,
                            title: this.newTodoTitle,
                            completed: false,
                            removed: false
                        });
                        this.newTodoTitle = '';
                        this.checkEmpty = false;
                        this.delayTime = '0';
                    }
                },
                editDone: function (todo) {
                    if (todo.title === '') {
                        this.removeTodo(todo);
                    }
                    this.editedTodo = null;
                },
                cancelEdit: function (todo) {
                    todo.title = this.editedTodo.title;
                    this.editedTodo = null;
                },
                clearCompleted: function () {
                    confirm('Confirm to clear all completed items?').then((confirmed) => {
                        if (confirmed) {
                            this.completedTodos.map(todo => todo.removed = true);
                            this.recycleBin.unshift(...this.completedTodos);
                            this.todos = this.leftTodos;
                        }
                    });
                },
                clearAll: function () {
                    confirm('Confirm to clear all todo items?').then((confirmed) => {
                        if (confirmed) {
                            this.todos.map(todo => todo.removed = true);
                            this.recycleBin.unshift(...this.todos);
                            this.todos = [];
                        }
                    });
                },

                // Drag Operations
                dragstart: function (index) {
                    this.dragIndex = index;
                },
                dragenter: function (e, index) {
                    e.preventDefault();
                    // Avoid source object triggering its own dragenter event
                    if (this.dragIndex !== index) {
                        const source = this.filteredTodos[this.dragIndex];
                        this.filteredTodos.splice(this.dragIndex, 1);
                        this.filteredTodos.splice(index, 0, source);
                        // After reordering, target index becomes source index
                        this.dragIndex = index;
                    }
                },
                dragover: function (e, index) {
                    e.preventDefault();
                },
                // JS hooks for animation
                beforeEnter(dom) {
                    dom.classList.add('drag-enter-active');
                },
                enter(dom, done) {
                    let delay = dom.dataset.delay;
                    setTimeout(() => {
                        this.delayTime = '1';
                        dom.classList.remove('drag-enter-active');
                        dom.classList.add('drag-enter-to');
                        let transitionend = window.ontransitionend
                            ? "transitionend"
                            : "webkitTransitionEnd";
                        dom.addEventListener(transitionend, function onEnd() {
                            dom.removeEventListener(transitionend, onEnd);
                            done();
                            // Call done() to tell Vue animation is complete, triggering afterEnter hook
                        })
                    }, delay);
                },
                afterEnter(dom) {
                    dom.classList.remove('drag-enter-to');
                },
                saveLanguage(lang) {
                    localStorage.setItem('uiineed-todos-lang', lang);
                },
                closeTaskDetail() {
                    this.selectedTask = null;
                },
                editTaskDetail() {
                    this.editingTask = JSON.parse(JSON.stringify(this.selectedTask)); // Deep copy
                    if (!this.editingTask.subtasks) {
                        this.editingTask.subtasks = [];
                    }
                    if (this.editingTask.progress === undefined) {
                        this.editingTask.progress = this.editingTask.completed ? 100 : 0;
                    }
                },
                cancelEditTaskDetail() {
                    this.editingTask = null;
                    this.showEditSubtask = false;
                },
                saveTaskDetail() {
                    if (this.editingTask.title) {
                        const index = this.todos.findIndex(t => t.id === this.editingTask.id);
                        if (index !== -1) {
                            // Update all properties of the todo
                            this.todos[index].title = this.editingTask.title;
                            this.todos[index].startDate = this.editingTask.startDate || '';
                            this.todos[index].endDate = this.editingTask.endDate || '';
                            this.todos[index].description = this.editingTask.description || '';
                            this.todos[index].completed = this.editingTask.completed || false;
                            this.todos[index].progress = this.editingTask.progress || 0;
                            this.todos[index].subtasks = this.editingTask.subtasks || [];
                            this.todos[index].priority = this.editingTask.priority || 'medium';

                            // Also update the selectedTask to show the updated details
                            this.selectedTask = { ...this.todos[index] };
                        }
                        this.editingTask = null;
                        this.showEditSubtask = false;
                    }
                },
                viewTaskDetail(todo) {
                    // Tạo bản sao sâu của todo
                    this.selectedTask = JSON.parse(JSON.stringify(todo));
                    console.log('Opening task detail:', this.selectedTask);

                    // Đảm bảo các thuộc tính cần thiết tồn tại
                    if (!this.selectedTask.subtasks) {
                        this.$set(this.selectedTask, 'subtasks', []);
                    }
                    if (this.selectedTask.progress === undefined) {
                        this.$set(this.selectedTask, 'progress', this.selectedTask.completed ? 100 : 0);
                    }
                },
                addSubtask() {
                    if (this.newSubtaskTitle.trim() === '') return;

                    // Đảm bảo selectedTask tồn tại
                    if (!this.selectedTask) return;

                    // Đảm bảo subtasks được khởi tạo
                    if (!this.selectedTask.subtasks) {
                        this.$set(this.selectedTask, 'subtasks', []);
                    }

                    // Thêm subtask mới với các trường giống task chính
                    const newSubtask = {
                        id: Date.now(),
                        title: this.newSubtaskTitle,
                        completed: false,
                        startDate: '',
                        endDate: '',
                        description: '',
                        progress: 0,
                        subtasks: [] // Cho phép subtask lồng nhau
                    };

                    this.selectedTask.subtasks.push(newSubtask);

                    // Cập nhật công việc gốc trong mảng todos
                    const index = this.todos.findIndex(t => t.id === this.selectedTask.id);
                    if (index !== -1) {
                        if (!this.todos[index].subtasks) {
                            this.$set(this.todos[index], 'subtasks', []);
                        }
                        this.todos[index].subtasks = [...this.selectedTask.subtasks];
                    }

                    // Reset form
                    this.newSubtaskTitle = '';
                    this.showAddSubtask = false;

                    // Cập nhật tiến độ
                    this.updateTaskProgress();
                },
                deleteSubtask(index) {
                    if (!this.selectedTask || !this.selectedTask.subtasks) return;

                    this.selectedTask.subtasks.splice(index, 1);

                    // Cập nhật lại tiến độ công việc
                    this.updateTaskProgress();
                },
                updateTaskProgress() {
                    if (!this.selectedTask) return;

                    // Đảm bảo subtasks được khởi tạo
                    if (!this.selectedTask.subtasks) {
                        this.$set(this.selectedTask, 'subtasks', []);
                    }

                    if (this.selectedTask.subtasks.length === 0) {
                        this.selectedTask.progress = this.selectedTask.completed ? 100 : 0;
                    } else {
                        const completedCount = this.selectedTask.subtasks.filter(subtask => subtask.completed).length;
                        const totalCount = this.selectedTask.subtasks.length;
                        this.selectedTask.progress = Math.round((completedCount / totalCount) * 100);

                        // Tự động cập nhật trạng thái completed dựa trên tiến độ
                        if (this.selectedTask.progress === 100 && !this.selectedTask.completed) {
                            this.selectedTask.completed = true;
                        } else if (this.selectedTask.progress < 100 && this.selectedTask.completed) {
                            // Nếu tiến độ < 100% nhưng đang được đánh dấu là hoàn thành, cập nhật lại
                            this.selectedTask.completed = false;
                        }
                    }

                    // Cập nhật công việc gốc
                    const index = this.todos.findIndex(t => t.id === this.selectedTask.id);
                    if (index !== -1) {
                        if (!this.todos[index].progress) {
                            this.$set(this.todos[index], 'progress', 0);
                        }
                        this.todos[index].progress = this.selectedTask.progress;

                        if (!this.todos[index].subtasks) {
                            this.$set(this.todos[index], 'subtasks', []);
                        }
                        this.todos[index].subtasks = [...this.selectedTask.subtasks];

                        // Cập nhật trạng thái completed của task gốc
                        this.todos[index].completed = this.selectedTask.completed;
                    }
                },
                addSubtaskToEdit() {
                    if (this.newSubtaskTitle.trim() === '') return;
                    if (!this.editingTask.subtasks) {
                        this.editingTask.subtasks = [];
                    }

                    // Thêm subtask mới với các trường giống task chính
                    const newSubtask = {
                        id: Date.now(),
                        title: this.newSubtaskTitle,
                        completed: false,
                        startDate: '',
                        endDate: '',
                        description: '',
                        progress: 0,
                        subtasks: [] // Cho phép subtask lồng nhau
                    };

                    this.editingTask.subtasks.push(newSubtask);
                    this.newSubtaskTitle = '';
                    this.showEditSubtask = false;
                },
                deleteSubtaskFromEdit(index) {
                    this.editingTask.subtasks.splice(index, 1);
                },
                addAdvancedSubtask() {
                    if (this.newSubtaskTitle.trim() === '') return;

                    // Thêm subtask mới với các trường giống task chính
                    const newSubtask = {
                        id: Date.now(),
                        title: this.newSubtaskTitle,
                        completed: false,
                        startDate: '',
                        endDate: '',
                        description: '',
                        progress: 0,
                        subtasks: [] // Cho phép subtask lồng nhau
                    };

                    this.advancedTodo.subtasks.push(newSubtask);
                    this.newSubtaskTitle = '';
                    this.showAddAdvancedSubtask = false;
                },
                deleteAdvancedSubtask(index) {
                    this.advancedTodo.subtasks.splice(index, 1);
                },
                saveAdvancedTodo() {
                    this.todos.push({
                        id: todoStorage.uid++,
                        title: this.advancedTodo.title,
                        completed: false,
                        removed: false,
                        startDate: this.advancedTodo.startDate,
                        endDate: this.advancedTodo.endDate,
                        description: this.advancedTodo.description,
                        progress: this.advancedTodo.progress,
                        subtasks: this.advancedTodo.subtasks,
                        priority: this.advancedTodo.priority || 'medium'
                    });
                    this.advancedTodo = {
                        title: '',
                        startDate: '',
                        endDate: '',
                        description: '',
                        progress: 0,
                        subtasks: [],
                        priority: 'medium'
                    };
                    this.showAdvancedAdd = false;
                    this.showAddAdvancedSubtask = false;
                },
                cancelAdvancedAdd() {
                    this.advancedTodo = {
                        title: '',
                        startDate: '',
                        endDate: '',
                        description: '',
                        progress: 0,
                        subtasks: []
                    };
                    this.showAdvancedAdd = false;
                    this.showAddAdvancedSubtask = false;
                },
                toggleSubtaskDetails(subtask) {
                    // Sử dụng $set để đảm bảo tính phản ứng
                    if (subtask.showDetails === undefined) {
                        this.$set(subtask, 'showDetails', true);
                    } else {
                        subtask.showDetails = !subtask.showDetails;
                    }
                },
                editSubtask(subtask) {
                    // Hiển thị form chỉnh sửa subtask
                    this.editingSubtask = JSON.parse(JSON.stringify(subtask));
                    this.showEditSubtaskForm = true;
                },
                cancelEditSubtask() {
                    this.editingSubtask = null;
                    this.showEditSubtaskForm = false;
                },
                saveEditSubtask() {
                    if (!this.editingSubtask || !this.editingSubtask.title || !this.selectedTask) return;

                    // Tìm vị trí của subtask trong mảng
                    const index = this.selectedTask.subtasks.findIndex(s => s.id === this.editingSubtask.id);
                    if (index !== -1) {
                        // Cập nhật subtask
                        this.selectedTask.subtasks[index] = { ...this.editingSubtask };

                        // Cập nhật trong công việc gốc
                        const todoIndex = this.todos.findIndex(t => t.id === this.selectedTask.id);
                        if (todoIndex !== -1) {
                            if (!this.todos[todoIndex].subtasks) {
                                this.$set(this.todos[todoIndex], 'subtasks', []);
                            }
                            this.todos[todoIndex].subtasks = [...this.selectedTask.subtasks];
                        }

                        // Cập nhật tiến độ
                        this.updateTaskProgress();

                    }

                    // Đóng form
                    this.showEditSubtaskForm = false;
                    this.editingSubtask = null;
                },
                // Check if a task is overdue
                isOverdue(todo) {
                    if (!todo.endDate) return false;
                    const endDate = new Date(todo.endDate);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0); // Compare dates only, not time
                    return endDate < today;
                },
                // Check if a task is due soon (within 3 days)
                isDueSoon(todo) {
                    if (!todo.endDate) return false;
                    const endDate = new Date(todo.endDate);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const threeDaysFromNow = new Date(today);
                    threeDaysFromNow.setDate(today.getDate() + 3);
                    return endDate >= today && endDate <= threeDaysFromNow;
                },
                // Apply sorting to the todos list
                applySorting() {
                    // The computed filteredTodos property will use these sort settings
                    // We're just ensuring any UI updates happen
                    this.$forceUpdate();
                },
                // Get days until due date (negative if overdue)
                getDaysUntilDue(todo) {
                    if (!todo.endDate) return null;
                    const endDate = new Date(todo.endDate);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const diffTime = endDate - today;
                    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                },
                searchTodos() {
                    // Implement search functionality
                    console.log('Searching todos:', this.searchQuery);
                },
                checkUpcomingTasks() {
                    // Lọc các công việc sắp đến hạn trong 3 ngày tới
                    this.upcomingTasks = this.todos.filter(todo => {
                        if (!todo.completed && todo.endDate) {
                            const daysLeft = this.getDaysLeft(todo);
                            return daysLeft >= 0 && daysLeft <= 3;
                        }
                        return false;
                    });

                    // Sắp xếp theo ngày hết hạn gần nhất
                    this.upcomingTasks.sort((a, b) => {
                        return new Date(a.endDate) - new Date(b.endDate);
                    });

                    // Hiển thị thông báo nếu có công việc sắp đến hạn
                    this.showReminders = this.upcomingTasks.length > 0;
                    console.log('Upcoming tasks:', this.upcomingTasks);
                    console.log('Show reminders:', this.showReminders);
                },
                getDaysLeft(todo) {
                    if (!todo.endDate) return null;

                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    const endDate = new Date(todo.endDate);
                    endDate.setHours(0, 0, 0, 0);

                    const diffTime = endDate - today;
                    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                },
                searchTodos() {
                    // Implement search functionality
                    console.log('Searching todos:', this.searchQuery);

                    // Update filtered todos based on search query
                    if (!this.searchQuery.trim()) {
                        // If search query is empty, reset search
                        this.intention = 'all';
                        return;
                    }

                    // Filter todos that match the search query
                    const query = this.searchQuery.toLowerCase();
                    this.intention = 'search';
                },
                handleClick(event) {
                    // Đảm bảo popup hiển thị khi click vào công việc
                    const taskDetail = document.querySelector('.task-detail-popup');
                    if (this.selectedTask && !taskDetail.contains(event.target) &&
                        !event.target.closest('.todo-content')) {
                        this.selectedTask = null;
                    }
                }
            },

            mounted() {
                this.show = true;
                var that = this;
                this.contorlScreen();
                // Attach window.onresize event to mounted function
                window.onresize = () => {
                    return (() => {
                        window.fullWidth = document.documentElement.clientWidth;
                        that.windowWidth = window.fullWidth; // width
                    })()
                };
                // Load slogan from localStorage
                this.slogan = localStorage.getItem('uiineed-slogan') || "Act Now, Simplify Life.☕";
                console.log('Vue mounted successfully', this.todos);

                // Tải dữ liệu từ localStorage
                this.todos = todoStorage.fetch() || [];
                this.delayTime = 0;

                // Bật transitions
                setTimeout(() => {
                    this.show = true;
                }, 200);

                // Kiểm tra các công việc sắp đến hạn ngay khi ứng dụng khởi động
                this.checkUpcomingTasks();

                // Hiển thị thông báo ngay sau khi khởi động
                setTimeout(() => {
                    console.log('Showing reminders:', this.upcomingTasks.length > 0);
                    this.showReminders = this.upcomingTasks.length > 0;
                }, 1000);

                // Cài đặt interval để kiểm tra các công việc sắp đến hạn mỗi giờ
                setInterval(() => {
                    this.checkUpcomingTasks();
                }, 60 * 60 * 1000);
            },

            directives: {
                focus: {
                    inserted: function (el) {
                        el.focus()
                    }
                }
            },

            computed: {
                emptyChecked: function () {
                    return this.newTodoTitle.length === 0 && this.checkEmpty
                },
                leftTodos: function () {
                    return this.todos.filter(function (todo) {
                        return !todo.completed
                    })
                },
                leftTodosCount: function () {
                    return this.leftTodos.length
                },
                hasRemovedTodo: function () {
                    return !!this.removedTodo
                },
                completedTodos: function () {
                    return this.todos.filter(function (todo) {
                        return todo.completed
                    })
                },
                completedTodosCount: function () {
                    return this.completedTodos.length
                },
                filteredTodos() {
                    let result;

                    // First filter based on the selected filter
                    if (this.intention === 'ongoing') {
                        result = this.todos.filter(todo => !todo.completed);
                    } else if (this.intention === 'completed') {
                        result = this.todos.filter(todo => todo.completed);
                    } else if (this.intention === 'removed') {
                        result = this.recycleBin;
                    } else if (this.intention === 'search' && this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        result = this.todos.filter(todo =>
                            todo.title.toLowerCase().includes(query) ||
                            (todo.description && todo.description.toLowerCase().includes(query))
                        );
                    } else {
                        result = this.todos;
                    }

                    // Then sort the results based on chosen criteria
                    return result.slice().sort((a, b) => {
                        // Determine sort values based on sort criteria
                        switch (this.sortBy) {
                            case 'dateCreated':
                                // Ngày tạo gần nhất (ID lớn hơn = mới hơn)
                                return b.id - a.id;

                            case 'dueDate':
                                // Xử lý quá hạn lên đầu, sau đó đến hạn gần hơn lên trên
                                const today = new Date();
                                today.setHours(0, 0, 0, 0);

                                const aEndDate = a.endDate ? new Date(a.endDate) : null;
                                const bEndDate = b.endDate ? new Date(b.endDate) : null;

                                // Nếu không có ngày hết hạn, đặt xuống cuối
                                if (!aEndDate && !bEndDate) return 0;
                                if (!aEndDate) return 1;
                                if (!bEndDate) return -1;

                                const aOverdue = aEndDate < today;
                                const bOverdue = bEndDate < today;

                                // Nếu một cái quá hạn và cái còn lại không
                                if (aOverdue && !bOverdue) return -1;
                                if (!aOverdue && bOverdue) return 1;

                                // Nếu cả hai đều quá hạn hoặc chưa quá hạn, sắp xếp theo ngày gần nhất
                                return aEndDate - bEndDate;

                            case 'priority':
                                // Mức độ ưu tiên cao nhất lên đầu
                                const priorityValues = { high: 3, medium: 2, low: 1, undefined: 0 };
                                const aPriority = priorityValues[a.priority] || 0;
                                const bPriority = priorityValues[b.priority] || 0;
                                return bPriority - aPriority;

                            case 'progress':
                                // Tiến độ hoàn thành ít nhất lên đầu
                                const aProgress = a.progress || 0;
                                const bProgress = b.progress || 0;
                                return aProgress - bProgress;

                            default:
                                // Mặc định theo ngày tạo gần nhất
                                return b.id - a.id;
                        }
                    });
                },
                showEmptyTips() {
                    return this.filteredTodos.length === 0 && this.intention !== 'removed';
                }

            }
        })
    </script>
    <script>
        // Fetch data from localStorage
        var fetchedTodos = todoStorage.fetch();
        console.log('Todos fetched from storage:', fetchedTodos);

        const handleClickDownload = () => {
            const todosText = JSON.stringify(todoStorage.fetch(), null, 2);
            const date = new Date().toISOString().replace(/-|:|\.(\d+)/g, '');

            const fileName = `todos-${date.slice(0, 8)}-${date.slice(9, 15)}.txt`;

            const element = document.createElement('a');
            element.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(todosText);
            element.download = fileName;

            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        };

        // Add debug point
        console.log('Vue instance created:', app);
        console.log('DOM elements:', {
            todoWrapper: document.querySelector('.todo-wrapper'),
            todoApp: document.querySelector('#todo-app'),
            taskDetailPopup: document.querySelector('.task-detail-popup')
        });

        // Import file
        let tempFileInput = null; // Store dynamically created file input element
        document.getElementById('import').addEventListener('click', function () {
            if (!tempFileInput) {
                tempFileInput = document.createElement('input');
                tempFileInput.type = 'file';
                tempFileInput.accept = '.txt,.json';
                tempFileInput.style.display = 'none';
                this.parentNode.appendChild(tempFileInput);


                tempFileInput.addEventListener('change', function (event) {
                    var file = event.target.files[0];
                    if (!file) return alert('No file selected!', 'Error');
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var content = e.target.result;
                        try {
                            var importedData;
                            if (file.type === 'application/json') {
                                // If JSON file, parse directly
                                importedData = JSON.parse(content);
                            } else if (file.type === 'text/plain') {
                                // If TXT file, try to parse as JSON
                                importedData = JSON.parse(content.trim());
                            } else {
                                throw new Error('Unsupported file type');
                            }
                            // Get current data from localStorage
                            var currentTodos = todoStorage.fetch() || [];
                            // Get current data count for new unique ids
                            var nextIdIndex = currentTodos.length;
                            // Update ids for imported data
                            importedData.forEach((item, index) => {
                                item.id = nextIdIndex + index;
                            });
                            // Append imported data to existing data
                            var updatedTodos = currentTodos.concat(importedData);
                            // Update localStorage
                            todoStorage.save(updatedTodos);
                            // Update page content
                            updatePageContent(updatedTodos);
                            alert('File imported successfully, data has been appended!');
                        } catch (error) {
                            alert('File parsing error, please ensure correct format: ' + error.message, 'Error');
                        }
                    };
                    reader.onerror = function (e) {
                        alert('Error reading file: ' + e.target.error.name, 'Error');
                    };
                    reader.readAsText(file);
                    this.parentNode.removeChild(tempFileInput);
                    tempFileInput = null;
                });
            }
            tempFileInput.click();
        });

        function updatePageContent(data) {
            app.todos = data;
        }

    </script>

    <!-- Toast Notification -->
    <div class="toast-notification">
        This is a notification message!
    </div>
    <script>
        // Override the original showToast function with our improved version
        window.addEventListener('load', function () {
            // We need to replace the original showToast function with our enhanced version
            window.showToast = function () {
                const todos = app.leftTodos; // Lấy các công việc chưa hoàn thành
                if (todos.length === 0) {
                    return; // Không hiển thị gì nếu không có công việc
                }

                // First check for overdue tasks
                const overdueTasks = todos.filter(todo => app.isOverdue(todo));
                // Then check for tasks due soon
                const dueSoonTasks = todos.filter(todo => app.isDueSoon(todo) && !app.isOverdue(todo));

                let selectedTodo;
                let notificationType = 'normal';

                // Prioritize overdue tasks, then due soon tasks, then random tasks
                if (overdueTasks.length > 0) {
                    selectedTodo = overdueTasks[Math.floor(Math.random() * overdueTasks.length)];
                    notificationType = 'overdue';
                } else if (dueSoonTasks.length > 0) {
                    selectedTodo = dueSoonTasks[Math.floor(Math.random() * dueSoonTasks.length)];
                    notificationType = 'due-soon';
                } else {
                    selectedTodo = todos[Math.floor(Math.random() * todos.length)];
                }

                // Tính thời gian còn lại
                let timeRemaining = '';
                let timeMessage = '';
                if (selectedTodo.endDate) {
                    const endDate = new Date(selectedTodo.endDate);
                    const now = new Date();
                    const diffTime = endDate - now;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    if (diffDays > 0) {
                        timeRemaining = `còn ${diffDays} ngày`;
                        timeMessage = 'Hãy hoàn thành đúng hạn!';
                    } else if (diffDays === 0) {
                        timeRemaining = 'hết hạn hôm nay';
                        timeMessage = 'Hãy hoàn thành ngay hôm nay!';
                    } else {
                        timeRemaining = `đã quá hạn ${Math.abs(diffDays)} ngày`;
                        timeMessage = 'Cần hoàn thành gấp!';
                    }
                } else {
                    timeRemaining = 'chưa có hạn';
                    timeMessage = 'Hãy thiết lập hạn!';
                }

                const toast = document.querySelector('.toast-notification');

                // Remove previous classes
                toast.classList.remove('overdue', 'due-soon', 'normal');
                // Add current type class
                toast.classList.add(notificationType);

                // Tạo nội dung thông báo
                let message = '';

                if (notificationType === 'overdue') {
                    message += `⚠️ CÔNG VIỆC QUÁ HẠN: "${selectedTodo.title}"\n`;
                    message += `Thời gian: ${timeRemaining}\n`;
                    message += `${timeMessage}`;
                } else if (notificationType === 'due-soon') {
                    message += `⏰ CÔNG VIỆC SẮP ĐẾN HẠN: "${selectedTodo.title}"\n`;
                    message += `Thời gian: ${timeRemaining}\n`;
                    message += `${timeMessage}`;
                } else {
                    message += `Nhắc nhở: "${selectedTodo.title}"\n`;
                    message += `Thời gian: ${timeRemaining}`;
                }

                toast.style.whiteSpace = 'pre-line';
                toast.textContent = message;

                // Hiển thị toast
                toast.classList.add('showing');
                toast.classList.remove('hiding');

                setTimeout(() => {
                    toast.classList.remove('showing');
                    toast.classList.add('hiding');
                    setTimeout(() => {
                        toast.classList.remove('hiding');
                    }, 500); // Đợi animation kết thúc
                }, 5000); // Show for 5 seconds
            };

            // Trigger notification shortly after page loads
            setTimeout(showToast, 1000);

            // Show notifications every 30 seconds
            setInterval(showToast, 30000);
        });
    </script>
</body>

</html>